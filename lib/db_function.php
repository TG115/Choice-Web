<?
    include_once $_SERVER['DOCUMENT_ROOT'].'/lib/database.php';

	$lv_exps = [
		// 1 ~ 100
		50, 150, 300, 500, 750, 1050, 1400, 1800, 2250, 2750, 
		3300, 3900, 4550, 5250, 6000, 6800, 7650, 8550, 9500, 10500, 
		11550, 12650, 13800, 15000, 16250, 17550, 18900, 20300, 21750, 23250, 
		24800, 26400, 28050, 29750, 31500, 33300, 35150, 37050, 39000, 41000, 
		43050, 45150, 47300, 49500, 51750, 54050, 56400, 58800, 61250, 63750, 
		66300, 68900, 71550, 74250, 77000, 79800, 82650, 85550, 88500, 91500, 
		94550, 97650, 100800, 104000, 107250, 110550, 113900, 117300, 120750, 124250, 
		127800, 131400, 135050, 138750, 142500, 146300, 150150, 154050, 158000, 162000, 
		166050, 170150, 174300, 178500, 182750, 187050, 191400, 195800, 200250, 204750, 
		209300, 213900, 218550, 223250, 228000, 232800, 237650, 242550, 247500, 252500, 
	
		// 101 ~ 200
		257550, 262650, 267800, 273000, 278250, 283550, 288900, 294300, 299750, 305250, 
		310800, 316400, 322050, 327750, 333500, 339300, 345150, 351050, 357000, 363000, 
		369050, 375150, 381300, 387500, 393750, 400050, 406400, 412800, 419250, 425750, 
		432300, 438900, 445550, 452250, 459000, 465800, 472650, 479550, 486500, 493500, 
		500550, 507650, 514800, 522000, 529250, 536550, 543900, 551300, 558750, 566250, 
		573800, 581400, 589050, 596750, 604500, 612300, 620150, 628050, 636000, 644000, 
		652050, 660150, 668300, 676500, 684750, 693050, 701400, 709800, 718250, 726750, 
		735300, 743900, 752550, 761250, 770000, 778800, 787650, 796550, 805500, 814500, 
		823550, 832650, 841800, 851000, 860250, 869550, 878900, 888300, 897750, 907250, 
		916800, 926400, 936050, 945750, 955500, 965300, 975150, 985050, 995000, 1005000, 
		
		// 201 ~ 300
		1015050, 1025150, 1035300, 1045500, 1055750, 1066050, 1076400, 1086800, 1097250, 1107750, 
		1118300, 1128900, 1139550, 1150250, 1161000, 1171800, 1182650, 1193550, 1204500, 1215500, 
		1226550, 1237650, 1248800, 1260000, 1271250, 1282550, 1293900, 1305300, 1316750, 1328250, 
		1339800, 1351400, 1363050, 1374750, 1386500, 1398300, 1410150, 1422050, 1434000, 1446000, 
		1458050, 1470150, 1482300, 1494500, 1506750, 1519050, 1531400, 1543800, 1556250, 1568750, 
		1581300, 1593900, 1606550, 1619250, 1632000, 1644800, 1657650, 1670550, 1683500, 1696500, 
		1709550, 1722650, 1735800, 1749000, 1762250, 1775550, 1788900, 1802300, 1815750, 1829250, 
		1842800, 1856400, 1870050, 1883750, 1897500, 1911300, 1925150, 1939050, 1953000, 1967000, 
		1981050, 1995150, 2009300, 2023500, 2037750, 2052050, 2066400, 2080800, 2095250, 2109750, 
		2124300, 2138900, 2153550, 2168250, 2183000, 2197800, 2212650, 2227550, 2242500, 2257500, 
	
		// 301 ~ 400
		2272550, 2287650, 2302800, 2318000, 2333250, 2348550, 2363900, 2379300, 2394750, 2410250, 
		2425800, 2441400, 2457050, 2472750, 2488500, 2504300, 2520150, 2536050, 2552000, 2568000, 
		2584050, 2600150, 2616300, 2632500, 2648750, 2665050, 2681400, 2697800, 2714250, 2730750, 
		2747300, 2763900, 2780550, 2797250, 2814000, 2830800, 2847650, 2864550, 2881500, 2898500, 
		2915550, 2932650, 2949800, 2967000, 2984250, 3001550, 3018900, 3036300, 3053750, 3071250, 
		3088800, 3106400, 3124050, 3141750, 3159500, 3177300, 3195150, 3213050, 3231000, 3249000, 
		3267050, 3285150, 3303300, 3321500, 3339750, 3358050, 3376400, 3394800, 3413250, 3431750, 
		3450300, 3468900, 3487550, 3506250, 3525000, 3543800, 3562650, 3581550, 3600500, 3619500, 
		3638550, 3657650, 3676800, 3696000, 3715250, 3734550, 3753900, 3773300, 3792750, 3812250, 
		3831800, 3851400, 3871050, 3890750, 3910500, 3930300, 3950150, 3970050, 3990000, 4010000, 
	
		// 401 ~ 500
		4030050, 4050150, 4070300, 4090500, 4110750, 4131050, 4151400, 4171800, 4192250, 4212750, 
		4233300, 4253900, 4274550, 4295250, 4316000, 4336800, 4357650, 4378550, 4399500, 4420500, 
		4441550, 4462650, 4483800, 4505000, 4526250, 4547550, 4568900, 4590300, 4611750, 4633250, 
		4654800, 4676400, 4698050, 4719750, 4741500, 4763300, 4785150, 4807050, 4829000, 4851000, 
		4873050, 4895150, 4917300, 4939500, 4961750, 4984050, 5006400, 5028800, 5051250, 5073750, 
		5096300, 5118900, 5141550, 5164250, 5187000, 5209800, 5232650, 5255550, 5278500, 5301500, 
		5324550, 5347650, 5370800, 5394000, 5417250, 5440550, 5463900, 5487300, 5510750, 5534250, 
		5557800, 5581400, 5605050, 5628750, 5652500, 5676300, 5700150, 5724050, 5748000, 5772000, 
		5796050, 5820150, 5844300, 5868500, 5892750, 5917050, 5941400, 5965800, 5990250, 6014750, 
		6039300, 6063900, 6088550, 6113250, 6138000, 6162800, 6187650, 6212550, 6237500, 6262500, 
	
		// 501 ~ 600
		6287550, 6312650, 6337800, 6363000, 6388250, 6413550, 6438900, 6464300, 6489750, 6515250, 
		6540800, 6566400, 6592050, 6617750, 6643500, 6669300, 6695150, 6721050, 6747000, 6773000, 
		6799050, 6825150, 6851300, 6877500, 6903750, 6930050, 6956400, 6982800, 7009250, 7035750, 
		7062300, 7088900, 7115550, 7142250, 7169000, 7195800, 7222650, 7249550, 7276500, 7303500, 
		7330550, 7357650, 7384800, 7412000, 7439250, 7466550, 7493900, 7521300, 7548750, 7576250, 
		7603800, 7631400, 7659050, 7686750, 7714500, 7742300, 7770150, 7798050, 7826000, 7854000, 
		7882050, 7910150, 7938300, 7966500, 7994750, 8023050, 8051400, 8079800, 8108250, 8136750, 
		8165300, 8193900, 8222550, 8251250, 8280000, 8308800, 8337650, 8366550, 8395500, 8424500, 
		8453550, 8482650, 8511800, 8541000, 8570250, 8599550, 8628900, 8658300, 8687750, 8717250, 
		8746800, 8776400, 8806050, 8835750, 8865500, 8895300, 8925150, 8955050, 8985000, 9015000, 
	
		// 601 ~ 700
		9045050, 9075150, 9105300, 9135500, 9165750, 9196050, 9226400, 9256800, 9287250, 9317750, 
		9348300, 9378900, 9409550, 9440250, 9471000, 9501800, 9532650, 9563550, 9594500, 9625500, 
		9656550, 9687650, 9718800, 9750000, 9781250, 9812550, 9843900, 9875300, 9906750, 9938250, 
		9969800, 10001400, 10033050, 10064750, 10096500, 10128300, 10160150, 10192050, 10224000, 10256000, 
		10288050, 10320150, 10352300, 10384500, 10416750, 10449050, 10481400, 10513800, 10546250, 10578750, 
		10611300, 10643900, 10676550, 10709250, 10742000, 10774800, 10807650, 10840550, 10873500, 10906500, 
		10939550, 10972650, 11005800, 11039000, 11072250, 11105550, 11138900, 11172300, 11205750, 11239250, 
		11272800, 11306400, 11340050, 11373750, 11407500, 11441300, 11475150, 11509050, 11543000, 11577000, 
		11611050, 11645150, 11679300, 11713500, 11747750, 11782050, 11816400, 11850800, 11885250, 11919750, 
		11954300, 11988900, 12023550, 12058250, 12093000, 12127800, 12162650, 12197550, 12232500, 12267500, 
	
		// 701 ~ 800
		12302550, 12337650, 12372800, 12408000, 12443250, 12478550, 12513900, 12549300, 12584750, 12620250, 
		12655800, 12691400, 12727050, 12762750, 12798500, 12834300, 12870150, 12906050, 12942000, 12978000, 
		13014050, 13050150, 13086300, 13122500, 13158750, 13195050, 13231400, 13267800, 13304250, 13340750, 
		13377300, 13413900, 13450550, 13487250, 13524000, 13560800, 13597650, 13634550, 13671500, 13708500, 
		13745550, 13782650, 13819800, 13857000, 13894250, 13931550, 13968900, 14006300, 14043750, 14081250, 
		14118800, 14156400, 14194050, 14231750, 14269500, 14307300, 14345150, 14383050, 14421000, 14459000, 
		14497050, 14535150, 14573300, 14611500, 14649750, 14688050, 14726400, 14764800, 14803250, 14841750, 
		14880300, 14918900, 14957550, 14996250, 15035000, 15073800, 15112650, 15151550, 15190500, 15229500, 
		15268550, 15307650, 15346800, 15386000, 15425250, 15464550, 15503900, 15543300, 15582750, 15622250, 
		15661800, 15701400, 15741050, 15780750, 15820500, 15860300, 15900150, 15940050, 15980000, 16020000, 
	
		// 801 ~ 900
		16060050, 16100150, 16140300, 16180500, 16220750, 16261050, 16301400, 16341800, 16382250, 16422750, 
		16463300, 16503900, 16544550, 16585250, 16626000, 16666800, 16707650, 16748550, 16789500, 16830500, 
		16871550, 16912650, 16953800, 16995000, 17036250, 17077550, 17118900, 17160300, 17201750, 17243250, 
		17284800, 17326400, 17368050, 17409750, 17451500, 17493300, 17535150, 17577050, 17619000, 17661000, 
		17703050, 17745150, 17787300, 17829500, 17871750, 17914050, 17956400, 17998800, 18041250, 18083750, 
		18126300, 18168900, 18211550, 18254250, 18297000, 18339800, 18382650, 18425550, 18468500, 18511500, 
		18554550, 18597650, 18640800, 18684000, 18727250, 18770550, 18813900, 18857300, 18900750, 18944250, 
		18987800, 19031400, 19075050, 19118750, 19162500, 19206300, 19250150, 19294050, 19338000, 19382000, 
		19426050, 19470150, 19514300, 19558500, 19602750, 19647050, 19691400, 19735800, 19780250, 19824750, 
		19869300, 19913900, 19958550, 20003250, 20048000, 20092800, 20137650, 20182550, 20227500, 20272500, 
	
		// 901 ~ 1000
		20317550, 20362650, 20407800, 20453000, 20498250, 20543550, 20588900, 20634300, 20679750, 20725250, 
		20770800, 20816400, 20862050, 20907750, 20953500, 20999300, 21045150, 21091050, 21137000, 21183000, 
		21229050, 21275150, 21321300, 21367500, 21413750, 21460050, 21506400, 21552800, 21599250, 21645750, 
		21692300, 21738900, 21785550, 21832250, 21879000, 21925800, 21972650, 22019550, 22066500, 22113500, 
		22160550, 22207650, 22254800, 22302000, 22349250, 22396550, 22443900, 22491300, 22538750, 22586250, 
		22633800, 22681400, 22729050, 22776750, 22824500, 22872300, 22920150, 22968050, 23016000, 23064000, 
		23112050, 23160150, 23208300, 23256500, 23304750, 23353050, 23401400, 23449800, 23498250, 23546750, 
		23595300, 23643900, 23692550, 23741250, 23790000, 23838800, 23887650, 23936550, 23985500, 24034500, 
		24083550, 24132650, 24181800, 24231000, 24280250, 24329550, 24378900, 24428300, 24477750, 24527250, 
		24576800, 24626400, 24676050, 24725750, 24775500, 24825300, 24875150, 24925050, 24975000, 25025000
	];

	function SQL_pointLog($user_id, $category, $text, $point) {
		$r = libQuery("
			SELECT point
			FROM hive_account
			WHERE user_id = ?
		;", "i", array($user_id));

		$remain_point = $r[0]['point'] + $point;

		libQuery("
			INSERT INTO hive_point_log
			VALUES (?, ?, ?, ?, ?, NOW())
		;", "issii", array($user_id, $category, $text, $point, $remain_point));
	}

	function SQL_setUserPoint($user_id, $point) {
		libQuery("
			UPDATE hive_account
			SET point = point + ?
			WHERE user_id = ?
		;", 'ii', array($point, $user_id));
	}

	function SQL_give_items($take_id, $itemname, $amount, $option) {
		
        libQuery("
            INSERT INTO hive_giveitem (give_id, take_id, idname, amount, flag, send_date)
            VALUES (?, ?, ?, ?, ?, NOW())
        ;", "iisis", array($_SESSION['user_id'] ?? $take_id, $take_id, $itemname, $amount, $option));
    }

	function SQL_getUserName($user_id) {
		$r = libQuery("
			SELECT nickname
			FROM hive_account
			WHERE user_id = '$user_id'
		;");

		return $r[0]['nickname'] ?? '알 수 없음';
	}

	function SQL_Get_bbs_like($idx) {
		$r = libQuery("
			SELECT COUNT(*) AS cnt
			FROM hive_bbs_likes
			WHERE idx = ?
		;", "i", array($idx));
	
		return $r[0]['cnt'];
	}

	function SQL_Get_bbs_comment($idx) {
		$r = libQuery("
			SELECT COUNT(*) AS cnt
			FROM hive_bbs_comment
			WHERE idx = ? AND dflag=0
		;", "i", array($idx));
	
		return $r[0]['cnt'];
	}


	function isAdminId($user_id) {
		$r = false;
		$row = libQuery("
			SELECT dvalue
			FROM vrp_user_data
			WHERE user_id = ? AND dkey = ?
		", 'is', array($user_id,'vRP:datatable'));

		if (isset($row[0])) {
			$dvalue = $row[0]['dvalue'];
			$data = json_decode($dvalue, true);
			$groups = $data['groups'];

			$adm = [
				'rorasujeong', 
				'namu1129',
				'superadmins',
				'normaladmins',
				'testadmins'
			];
			
			foreach($adm as $group) {
				if (array_key_exists($group, $groups)) {
					$r = true;
					break;
				}
			}
		}
    
    	return $r;
	}


	function myRank($exps){
		global $lv_exps;

		foreach ($lv_exps as $k => $v) {
			if ($exps <= $v) return $k+1;
		}
	}

	function get_exp_per($exps) {
		global $lv_exps;

		$lv = myRank($exps);
		$tot_exp = $lv_exps[$lv-1];
		$before_exp = 0;
		if ($lv > 1) {
			$before_exp = $lv_exps[$lv-2];
		}
		$remain_exp = $tot_exp - $before_exp;
		$my_exp = $exps - $before_exp;

		return number_format($my_exp / $remain_exp * 100, 2);
	}

?>